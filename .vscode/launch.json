{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Cortex Debug with SWO ITM",
            "cwd": "${workspaceFolder}",
            "executable": "${workspaceFolder}/build/firmware.elf",
            "request": "launch",
            "type": "cortex-debug",
            "servertype": "openocd",
            "device": "STM32F407VG",
            
            // Конфигурационные файлы OpenOCD
            "configFiles": [
                "interface/stlink.cfg",
                "target/stm32f4x.cfg"
            ],
            
            // Настройки SWO
            "swoConfig": {
                "enabled": true,
                "cpuFrequency": 168000000,    // Частота CPU МК
                "swoFrequency": 2000000,      // Частота SWO (обычно 2 МГц)
                "source": "probe",            // или "socket", "file"
                "swoPortMask": 0xFFFFFFFF,    // Маска включенных портов
                "swoPorts": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31],
                "decoders": [
                    {
                        "type": "console",
                        "label": "ITM Output",
                        "port": 0,           // Стандартный порт для printf
                        "encoding": "ascii"
                    },
                    {
                        "type": "console",
                        "label": "Debug Port 1",
                        "port": 1,
                        "encoding": "ascii"
                    },
                    {
                        "type": "binary",
                        "label": "Binary Data",
                        "port": 2
                    },
                    {
                        "type": "hex",
                        "label": "Hex Data", 
                        "port": 3
                    }
                ]
            },
            
            // Команды инициализации OpenOCD
            "openOCDLaunchCommands": [
                "init",
                "reset init",
                "arm tpiu config internal :3333 uart off 168000000 2000000",
                "arm itm port 0 on",
            ],
            
            // Дополнительные настройки
            "runToMain": true,
            "svdFile": "${workspaceFolder}/STM32F407.svd",
            "postDebugSession": "monitor reset halt"
        }
    ]
}